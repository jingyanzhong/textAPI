<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS in Settings -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">

    <title>Hello, world!</title>
    <style>
        .page-content {
            background: lightgrey;
            display: inline-block;
            padding: 15px;
            width: 100%;
            text-align: center;
            height: 150px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>

    <div class="container">
        <div class="zone" id="zone">
            <button type="button" class="btn btn-primary">大安區</button>
            <button type="button" class="btn btn-primary">信義區</button>
            <button type="button" class="btn btn-primary">中正區</button>
        </div>
        
        <ul class="content" id="content"></ul>

        <nav aria-label="Page navigation example">
            <ul class="pagination" id="pageid">
            </ul>
          </nav>




    </div>




    <!-- Optional JavaScript in Settings -->
    <!-- jQuery first, then other.js, then Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8"
        crossorigin="anonymous"></script>


    <script>
        const content = document.getElementById('content');
        const paginationid = document.getElementById('pageid');
        const zone = document.getElementById('zone');
        const corsURL = 'https://cors-anywhere.herokuapp.com/'; // use cors-anywhere to fetch api data
        const apiURL = 'https://gis.taiwan.net.tw/XMLReleaseALL_public/hotel_C_f.json'; // origin api url
        let data = [];
        let taipeiData = [];
        // api call
        axios
            .get(`${corsURL}${apiURL}`)
            .then((response) => {
                data = response.data.XML_Head.Infos.Info;
                filterData(data);
            }) // 把结果集传到info这个数组
            .catch((error) => {
                console.warn(error);
            });

        // 篩選出台北市飯店資訊
        function filterData(data){
            data.forEach(function(item){
                if(item.Region == '臺北市'){
                    taipeiData.push(item)
                }
            })
            // 將taipeiData放進分頁function計算分頁頁數製作Pagination
            renderView(taipeiData,1);
            pagination(taipeiData);
        }
        // 渲染
        function renderView(data,page,pageTotal){
            let str = '';
            let nowpage = page || 1 ;
            if(nowpage == pageTotal){
                        // console.log(page);
                for(let num = (nowpage * 20)-19; num < data.length ; num++){
                str += `<li>${taipeiData[num].Name}</li>`;
                };
            }else{
                for(let num = (nowpage * 20)-19; num <= nowpage*20 ; num++){
                str += `<li>${taipeiData[num].Name}</li>`;
                };
            }
            // data.forEach(function(item){
            //     str += `<li>${item.Name}</li>`
            // })
            content.innerHTML = str;
        }

        // 分頁
        function pagination(taipeiData,nowpage){
            const taipeiDataLength = taipeiData.length;
            const perpage = 20 ;
            const pageTotal = Math.ceil(taipeiDataLength / 20);
            // 當前頁數
            let currentPage = nowpage || 1;
            const minData = (currentPage * perpage) - perpage + 1 ;
            const maxData = (currentPage * perpage) ;
            const page = {
                taipeiDataLength,
                currentPage,
                pageTotal,
                hasPage: currentPage > 1,
                hasNext: currentPage < pageTotal,
            }
            
            // 當"當前頁數"比"總頁數"大的時候，"當前頁數"就等於"總頁數"
            if (currentPage > pageTotal) {
                currentPage = pageTotal;
            }
            pageBtn(page);
            renderView(taipeiData,currentPage,pageTotal)
            console.log(`資料總筆數:${taipeiDataLength}筆，每頁顯示${perpage}筆，總頁數:${pageTotal}頁`);
            console.log(taipeiData);
            console.log(currentPage);
        }

        function pageBtn(page){
            let str = '';
            const total = page.pageTotal;

            if(page.hasPage){
                str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) - 1}">Previous</a></li>`;
            } else {
                str += `<li class="page-item disabled"><span class="page-link">Previous</span></li>`;
            }

            for(let i = 1; i <= total; i++){
                if(page.currentPage == i){
                    str +=`<li class="page-item active"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
                } else {
                str +=`<li class="page-item"><a class="page-link" href="#" data-page="${i}">${i}</a></li>`;
                }
            };

            if(page.hasNext){
                str += `<li class="page-item"><a class="page-link" href="#" data-page="${Number(page.currentPage) + 1}">Next</a></li>`;
            } else {
                str += `<li class="page-item disabled"><span class="page-link">Next</span></li>`;
            }
            
            paginationid.innerHTML = str;
        }
        
        function switchPage(e){
            e.preventDefault();
            const page = e.target.dataset.page;
            console.log(page);
            pagination(taipeiData,page);
        }

        // function changeItem(e){
        //     let newData =[];
        //     let value = e.target.innerText;
        //     console.log(e.target.innerText);
        //     console.log(taipeiData);
        //     for(let i =0 ; i< taipeiData.length ; i++){
        //         if(value == taipeiData[i].Town){
        //             newData.push(taipeiData[i])
        //         }
        //     }
        //     pagination(newData);
        //     switchPage(e,newData)
        // }
        paginationid.addEventListener('click',switchPage)
        // zone.addEventListener('click',changeItem)
    </script>
</body>

</html>